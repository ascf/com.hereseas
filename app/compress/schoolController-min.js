hereseasApp.controller("SchoolController",["$stateParams","$scope","requestService","$state",function(t,e,a,s){function o(o){a.GetSchool({id:o},function(t){t.result?(e.image=t.data.image,e.avatar=t.data.avatar):s.go("home")}),a.GetNewSchoolMates({id:o},function(t){e.newSchoolMates=t.data}),a.GetSchoolMates({id:t.schoolId},function(t){e.schoolMates=t.data}),a.GetThreeApts({schoolId:o},function(t){t.result&&(e.aptImg1=t.data[0].cover,e.aptId1=t.data[0]._id,e.hasApt[0].exist=!0,t.data.length>=2&&(e.aptImg2=t.data[1].cover,e.aptId2=t.data[1]._id,e.hasApt[1].exist=!0),t.data.length>=3&&(e.aptImg3=t.data[2].cover,e.aptId3=t.data[2]._id,e.hasApt[2].exist=!0))}),a.GetThreeItems({schoolId:o},function(t){t.result&&(e.itemImg1=t.data[0].cover,e.itemId1=t.data[0]._id,e.hasItem[0].exist=!0,t.data.length>=2&&(e.itemImg2=t.data[1].cover,e.itemId2=t.data[1]._id,e.hasItem[1].exist=!0),t.data.length>=3&&(e.itemId3=t.data[2]._id,e.itemImg3=t.data[2].cover,e.hasItem[2].exist=!0))}),a.GetThreeCars({schoolId:o},function(t){t.result&&(e.carImg1=t.data[0].cover,e.carId1=t.data[0]._id,e.hasCar[0].exist=!0,t.data.length>=2&&(e.carId2=t.data[1]._id,e.carImg2=t.data[1].cover,e.hasCar[1].exist=!0),t.data.length>=3&&(e.carId3=t.data[2]._id,e.carImg3=t.data[2].cover,e.hasCar[2].exist=!0))})}e.schoolId=t.schoolId,e.new_users=[{img:"/app/view/img/user/img1.JPG"},{img:"/app/view/img/user/img1.JPG"},{img:"/app/view/img/user/img1.JPG"},{img:"/app/view/img/user/img1.JPG"},{img:"/app/view/img/user/img1.JPG"},{img:"/app/view/img/user/img1.JPG"}],e.hasItem=[{exist:!1},{exist:!1},{exist:!1}],e.hasCar=[{exist:!1},{exist:!1},{exist:!1}],e.hasApt=[{exist:!1},{exist:!1},{exist:!1}],o(t.schoolId),e.showAllApts=function(){s.go("allApts",{schoolId:t.schoolId})},e.showAllCars=function(){s.go("allCars",{schoolId:t.schoolId})},e.showAllItems=function(){s.go("allItems",{schoolId:t.schoolId})},e.showAllActivs=function(){s.go("allActivs",{schoolId:t.schoolId})},e.showOtherUserInfo=function(e){s.go("othersProfile",{schoolId:t.schoolId,othersId:e})}}]),hereseasApp.controller("SchoolSearchCtrl",["$scope","$state","requestService",function(t,e,a){a.GetSchools(function(a){t.hschools=[],t.ids=[];for(var s=[],o=0;o<a.data.length;o++)t.hschools.push(a.data[o].name),t.ids.push(a.data[o]._id),s.push(a.data[o]);t.$watch(function(){return t.selected},function(a,s){a!==s&&void 0!==a&&""!==a&&-1!==t.hschools.indexOf(a)&&e.go("school",{schoolId:t.ids[t.hschools.indexOf(a)]})});var i=function(t){return function(e,a){var s;s=[],substrRegex=new RegExp(e,"i"),$.each(t,function(t,e){substrRegex.test(e.name)&&s.push(e)}),a(s)}};$("#the-basics .typeahead").typeahead({minLength:0},{name:"best-pictures",display:"value",source:i(s),templates:{empty:['<div class="empty-message" style="text-align: center; color: black; padding: 5px, 10px;">',"您的学校正在开通，请先到附近的学校逛逛吧","</div>"].join("\n"),suggestion:function(t){return'<div class="tt-pic"><img src="'+t.avatar+'" width=30 height= 30/><strong>&nbsp&nbsp'+t.name+"</strong></div>"}}}),$(".typeahead").bind("typeahead:select",function(t,a){e.go("school",{schoolId:a._id})})})}]),hereseasApp.controller("SchoolMatesCtrl",["$scope","$stateParams","$state","requestService",function(t,e,a,s){s.GetSchoolMates({id:e.schoolId},function(e){t.schoolMates=e.data}),t.seeOthersProfile=function(s){a.go("othersProfile",{othersId:t.schoolMates[s]._id,schoolId:e.schoolId})}}]);